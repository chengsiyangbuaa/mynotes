恶意代码分析实战2022_01_12

#### 僵尸网络

- 僵尸网络 Botnet 是指采用一种或多种传播手段，将大量主机感染bot程序（[僵尸程序](https://baike.baidu.com/item/僵尸程序)）病毒，从而在控制者和被感染[主机](https://baike.baidu.com/item/主机/455151)之间所形成的一个可一对多控制的网络 [1] 。

- 攻击者通过各种途径传播僵尸程序感染互联网上的大量主机，而被感染的主机将通过一个[控制信道](https://baike.baidu.com/item/控制信道/5623827)接收攻击者的指令，组成一个僵尸网络。之所以用僵尸网络这个名字，是为了更形象地让人们认识到这类危害的特点：众多的计算机在不知不觉中如同中国古老传说中的僵尸群一样被人驱赶和指挥着，成为被人利用的一种工具。

#### 下载器

- 用来下载其他恶意代码
- 通常是攻击者获得系统的访问时**首先**进行安装的。下载器会**下载和安装**其他的恶意代码

#### 间谍软件

- “间谍软件”其实是一个灰色区域，所以并没有一个明确的定义。然而，正如同名字所暗示的一样，它通常被泛泛的定义为从计算机上搜集信息，并在未得到该计算机用户许可时便将信息传递到第三方的软件，包括监视击键，搜集机密信息（密码、信用卡号、[PIN码](https://baike.baidu.com/item/PIN码)等），获取电子邮件地址，跟踪浏览习惯等。间谍软件还有一个副产品，在其影响下这些行为不可避免的影响网络性能，减慢系统速度，进而影响整个商业进程。虽然其原理也是基于[C/S模式](https://baike.baidu.com/item/C%2FS模式/5309599)的网络连接，但是在连接时却将态度转了180度：这次的入侵，发出第一个连接请求的不再是[远程控制](https://baike.baidu.com/item/远程控制)者使用的客户端，而是受害者的木马[服务器](https://baike.baidu.com/item/服务器)端。第一个使用此概念的木马名为“[网络神偷](https://baike.baidu.com/item/网络神偷)”，被设计用来从局域网内往外盗取文件数据。

#### 启动器

- 通常为可执行文件，用来安装立即运行或将来秘密执行的恶意代码，通常包含一段它所运行的恶意代码
- 用来**启动其他恶意程序**的恶意代码
- 通常情况下，启动器使用一些**非传统的技术**，来启动其他恶意程序，以确保**隐蔽性**，或以获得更高权限访问系统

#### 内核套件

- 设计用来**隐藏**其他恶意代码的恶意代码。内核套件通常是与其他恶意代码（如后门）组合工具套装，来允许为攻击者提供远程访问，并且使代码**很难被受害者发现**。

#### 勒索软件（ransomware）

- 一种流行的[木马](https://baike.baidu.com/item/木马/530)，通过骚扰、恐吓甚至采用绑架用户文件等方式，使用户数据资产或[计算资源](https://baike.baidu.com/item/计算资源/19140081)无法正常使用，并以此为条件向用户勒索钱财。这类用户数据资产包括文档、邮件、数据库、源代码、图片、压缩文件等多种文件。赎金形式包括真实货币、比特币或其它虚拟货币。

  一般来说，勒索软件作者还会设定一个支付时限，有时赎金数目也会随着时间的推移而上涨。有时，即使用户支付了赎金，最终也还是无法正常使用系统，无法还原被加密的文件。

#### 发送垃圾邮件的恶意代码

- 这类恶意代码在感染了计算机后，会利用其计算机和网络资源，发送大量垃圾邮件。通过出售垃圾邮件发送服务而收益。

#### 蠕虫或计算机病毒

- 可以自我复制和感染其他计算机的恶意代码。

恶意代码可能还会跨越类别。比如一个程序可能有一个键盘记录器，还有蠕虫组件。

#### 根据目标的分类

可以分为**大众型**和**针对型**两类。

### 0.4恶意代码的分析通用规则

- 不要过于陷于细节，不可能知道恶意代码的每一个细节，在进入到细节之前，要有一个概要认识。
- 针对不同的工作，使用不同的工具和方法。
- 恶意代码分析就像是猫捉老鼠的游戏，是双方的较量。

## 第1章——静态分析基础技术

静态分析技术通常也是研究恶意代码的**第一步**。

静态分析指的是通过**分析程序指令与结构**来确定功能的过程。

本章介绍从可执行文件中提取**有用信息**的多种方法：

- 使用**反病毒软件**确定程序样本的恶意性
- 使用哈希来识别恶意代码
- 从文件的**字符串列表、函数和文件头**信息中发掘有用信息

### 1.1反病毒引擎扫描

分析恶意代码的第一步，就是拿多个反病毒软件扫描这个文件，看看是否有引擎能够识别他。

但是反病毒软件不是完美的，因为它们主要依靠一个已知恶意代码可识别片段的特征数据库（病毒文件特征库），以及基于行为和模式匹配的分析（启发式检测），来识别可疑文件。（**特征数据库**识别已知的恶意代码，**启发式检测**识别未知的恶意代码）

[启发式](https://baike.baidu.com/item/启发式/7365819)指的“自我发现的能力”或“运用某种方式或方法去判定事物的知识和技能”。

### 1.2哈希值：恶意代码的指纹

**哈希**是一种用来**唯一标识恶意代码**的常用方法。恶意代码样本通过一个哈希程序，会产生出一段用于唯一标识这个样本的独特哈希值（类似于一种指纹）。

MD5，SHA-1

### 1.3查找字符串

通过工具来分析二进制代码中的字符串信息。（字符串在二进制代码中也不会丢失，可以还原回来）

### 1.4加壳与混淆恶意代码

使用**加壳与混淆技术**，可以让恶意代码更难分析。

混淆程序是恶意代码编写者尝试去隐藏其执行过程的代码。加壳程序是混淆程序中的一类。

加壳后的代码会被**压缩**，并且难以分析。

合法程序一般会包含很多的字符串，而由被加壳或混淆的恶意代码直接分析获取的打印字符串很少。

用string程序分析一段代码时，如果发现字符串很少，那么它很有可能时加壳的。这时候就要用到静态分析以外的分析。

### 1.5PE文件格式（可移植执行）

可移植执行（PE）文件格式是windows可执行文件，对象代码和DLL所使用的标准格式。

PE文件格式其实是一种数据结构，包含为windows操作系统加载器管理可执行代码所必要的信息。

PE文件以一个文件头开始，其中包含代码信息，应用程序类型，所需库函数，空间要求。

### 1.6链接库与函数

**导入表**是最有用的信息之一。

导入函数：一个程序使用的但存储与另一个程序中的函数。

#### 三种链接方式

- 静态链接，动态链接，运行时链接。可以参考《程序员的自我修养》

- Dependency Walker工具探索动态链接函数
- 导入函数，一个程序使用的函数，但是它不在这个程序中，而是在另一个程序中
- 导出函数，一个程序的函数，它可以导出，供其他程序使用。DLL就是实现一些导出函数供exe文件使用

### 1.7静态技术分析实践

小文件，包含了大量导入函数，其中只有一部分有意义

在大量导入函数中，要找到我们感兴趣的导入函数。

